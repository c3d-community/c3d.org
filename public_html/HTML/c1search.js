// global members
var _d2hSecondaryWindowsByTopics = null;
function d2hInitSecondaryWindows()
{
    if (_d2hSecondaryWindowsByTopics == null)
    {
        _d2hSecondaryWindowsByTopics = new Array();
        _d2hSecondaryWindowsByTopics["documents/adtech.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/asciitextfiles.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thesystemswereused.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thepointer.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thenumberoftrajectories.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/c3dframenumbers.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/notspecifiedinthec3dfiledescription.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/3dscalefactor.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/analogsamplesfromeachchannelsampled.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/3dframerateinsamplespersecond.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/eventsstoredinthec3dheader.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/sincethefirstframe.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/fourcharacterlabel.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/applicationprocessingthedata.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/groupnameandparametername.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/parameterorgroupname.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thirdbyteoftheparameterheader.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/theendianformat.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thedescriptionstring.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thiscanbeapositiveornegativenumber.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/casualchangetothelockedvalue.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/starting.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/signed16bitintegersor32bitfloatingpoint.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/storedinsequence.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/signedintegerformatdata.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/scaledfloatingpointformat.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/thisdoesnotimplythattwoobservermeasurementsaremoreaccurate.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/cameramaskcanbeveryuseful.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/cameramask.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/integerc3dformat.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/signedintegersbydefault.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/floatingpointvalue.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/circumstances.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/someoftheseareessential.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointused.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointscale.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/3ddata1.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointrate.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointdatastart.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointframes.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointlabelsparameter.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/3ddatapointsinac3ddatafile.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/fouruppercasecharacters.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/255descriptions.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/astandardenvironment.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/originalc3dformatdescription.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/analogused.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/simplyduplicateinformationinthec3dfile.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/maximumpositiverange.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/adjustthezerobaselines.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/calculated.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/adcresolution.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/calibrationmatrix.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/forceplateperformance.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/analograte.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/signedorunsigned.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/analogdatafromtheforceplatform.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/forceplatformused.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/forceplatformzeroparameter.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/readcarefully.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/originvalues.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/pointlongframes.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/additionallabelsparameters.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/charstrings.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/twonewparameters.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/manufacturer.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/analoggain.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/additionalapplications.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/segparametergroup.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/encrypting.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/newerc3dfiles.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/signednumbers1.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/binarylevel.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/binaryc3dfileformats.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/datacollectionsystems.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_3ddata.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_3dframe.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_3dpoint.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_ascii.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_adc.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_analogdatasample.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_analogsampleformat.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_analogsamplerate.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_arrays.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_block.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_bytes.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_camarc.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_cameracontribution.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_characters.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_decintelandsgimips1.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_endian.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_floatingpoint1.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_integer.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_parameters.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_rawdata.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_real.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_records.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_residual.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_section.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_trial.htm"] = "d2hWnd_SecondaryPopup";
_d2hSecondaryWindowsByTopics["documents/gloss_utf8.htm"] = "d2hWnd_SecondaryPopup";

    }
}

function newDocContext(strTitle, strData)
{
    var elem = "<html><head>"
    if (strTitle != "")
        elem += "<title>" + strTitle + "</title>";
    elem += "</head><body>";
    elem += strData;
    elem += "</body></html>";
    document.clear();
    document.write(elem);
}

function jSearch(doc, strQuery)
{
    display(doc, jExecQuery(strQuery));
}

function jExecQuery(strQuery)
{
	strQuery = strQuery.replace(/\s+|\.|,|"|;|\(|\)|\{|\}|\[|\]|\|/g, " ").replace(/^\s+/g, "").replace(/\s+$/g, "").toLowerCase();
    var terms = removeRepeatingTerms(strQuery.split(" "));
    var arr = new Array();
	var strRealQuery = "";
    for (var i = 0; i < terms.length; i++)
    {
        var term = terms[i];
		strRealQuery += term + " ";
        var h = searchInIndex(term);
        if (h)
            arr = arr.concat(h);
    }
    arr = calcHistogram(arr);
    setQuery2EditBox(strRealQuery);
	return getQueryResult(arr);
}

function setQuery2EditBox(query)
{
    var frm = getFrameByName("textprovider");
    if (frm != null)
    {
        var doc = getFrameDocument(frm);
        if (doc != null)
        {
            var elmSearch = getElemById(doc, "query");
            if (elmSearch != null)
                elmSearch.value = query.replace(/\s+$/g, "");
        }
    }
}

function searchInIndex(term)
{
    var wildcard = isWildcard(term);
    if (wildcard)
    {
        var re = new RegExp(getWildcardRegexp(term), "gi");
        var indx;
        var res = null;
        for(var word in g_sWords)
        {
            indx = word.search(re);
            if (indx > -1)
            {
                if (res)
                    res = res.concat(g_sWords[word]);
                else
                    res = g_sWords[word];
            }
        }
        return res;
    }
    else
        return g_sWords[term];
}

function isWildcard(term)
{
    return term.indexOf("?") > -1 || term.indexOf("*") > -1;
}

function removeRepeatingTerms(terms)
{
    var htbl = new Array();
    var res = new Array();
    for (var i = 0; i < terms.length; i++)
        if (!htbl[terms[i]])
        {
            res[res.length] = terms[i];
            htbl[terms[i]] = true;
        }
    return res;
}

function calcHistogram(arr)
{
    var tbl = new Array();
    var id;
    for (var i = 0; i < arr.length; i++)
    {
        id = "x" + arr[i][0];
        if (tbl[id])
        {
            tbl[id][1] += arr[i][1];
            arr[i] = null;
        }
        else
            tbl[id] = arr[i];
    }
    arr.sort(sortByCounterNumber);
    return arr;
}

function sortByCounterNumber(x, y)
{
    if (x == null)
        return 1;
    if (y == null)
        return -1;
    var delta = x[1] - y[1];
    if (delta == 0)
        return 0;
    if (delta < 0)
        return 1;
    return -1;
}

function getQueryResult( arr)
{
    var res = "";
    for (var i = 0; i < arr.length; i++)
        if (arr[i])
            res += getResultItem(i, arr[i]);
    if (res.length == 0)
        res = "No topics found.";
    return res;
}

function getResultItem(id, item)
{
    var res = "";
    try
    {
        var td = g_sTopics[item[0]];
        if (td)
        {
            res = "<div nowrap class=\"clsSearchResultItem\"><a id=\"ri-" + id + "\" href=\"";
            res += td[0];

            res += "\" target=\"right\"";

            res += "onclick=\"return d2hSearchItemSelect(\'" + td[0] + "\', event)\" onmouseover=\"d2hItemOver(event)\" onmouseout=\"d2hItemOut(event)\">";
            res += td[1] + "</a></div>";
        }
    }
    catch (e)
    {
        res = "";
    }
    return res;
}

function display(doc, content)
{
    var elem = doc.forms[1];
    if (elem.parentNode)
        elem.parentNode.setAttribute("nowrap", true);
    waitCursor(doc, true);
    elem.innerHTML = content;
    waitCursor(doc, false);
}

function waitCursor(doc, isWait)
{
}
